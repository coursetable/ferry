version: "2"

services:
  db:
    image: postgres
    restart: always
    ports:
      - "5432:5432"
    environment:
      POSTGRES_PASSWORD: "thisisapassword"
  cron:
    build:
      context: .
      dockerfile: ./Dockerfile.cron
    restart: always
    environment:
      POSTGRES_URI: "postgresql+psycopg2://postgres:thisisapassword@db/postgres"
    volumes:
      - ./api_output:/app/api_output
      - ./drive_cache.tar.gz:/app/drive_cache.tar.gz
#  graphql-engine:
#    image: hasura/graphql-engine:latest
#    ports:
#      - "8080:8080"
#    network_mode: "host"
#    depends_on:
#    - "db"
#    restart: always
#    environment:
#      HASURA_GRAPHQL_DATABASE_URL: postgres://postgres:thisisapassword@localhost:5432/postgres
#      HASURA_GRAPHQL_ENABLE_CONSOLE: "true" # set to "false" to disable console
#      HASURA_GRAPHQL_ENABLED_LOG_TYPES: startup, http-log, webhook-log, websocket-log, query-log
#      ## uncomment next line to set an admin secret
#      # HASURA_GRAPHQL_ADMIN_SECRET: myadminsecretkey

